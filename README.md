# Tachyon apps Github provider

## 👍 GitHub API クライアントライブラリ

### 🚀 プロジェクト概要

このプロジェクトは、GitHub API を直接操作して、以下の機能を提供するクライアントライブラリを作成します。GitHub リポジトリに対するブランチ作成、ファイル変更を伴うコミット、そしてプルリクエスト作成をプログラムから自動化することを目的とします。

### 🎯 目標

*   GitHub API のみを利用する。
*   ブランチ作成、コミット作成、PR作成を実装する。
*   使いやすいインターフェースを提供する。
*   エラーハンドリングを実装する。

### ⚙️ 機能設計

*   **ブランチ作成:**
    *   指定されたリポジトリに新しいブランチを作成する。
    *   ベースブランチを指定して作成する。
        *   (GitHub API を利用してベースブランチの最新コミット SHA を取得)
        *   (GitHub API を利用して新しいブランチを作成)
*   **コミット作成:**
    *   指定されたブランチにファイルを追加・変更する。
    *   コミットメッセージを指定できる。
    *   既存のファイルを更新できる。
    *   複数のファイルを同時にコミットできる。
        *   (GitHub API を利用して対象ブランチの最新コミット SHA を取得)
        *   (GitHub API を利用して最新コミットのツリー SHA を取得)
        *   (GitHub API を利用してファイル内容の BLOB を作成)
        *   (GitHub API を利用して BLOB を含むツリーを作成)
        *   (GitHub API を利用して新しいコミットを作成)
        *   (GitHub API を利用してブランチの先端を更新)
*    **プルリクエスト作成:**
    *   指定したブランチをベースブランチにマージするプルリクエストを作成する。
    *   プルリクエストのタイトルと本文を指定できる。
    *   (GitHub API を利用してプルリクエストを作成)

### 🛠 実装タスクリスト

#### 📦 共通設定

*   ✅  **タスク:** GitHub API クライアントの基本構造を設計する。
    *   認証モジュール、API クライアント、リポジトリ操作モジュールなどの役割分担を明確にする。
*   ✅ **タスク:** GitHub API 認証を実装する。
    *   Personal Access Token を使用した認証機能を実装する。
    *   トークンを安全に管理する方法を検討する（環境変数など）。
        *   ヘッダー `Authorization: token {YOUR_TOKEN}` を設定。
*   ✅ **タスク:** GitHub API クライアントを実装する。
    *   API リクエスト (`GET`, `POST`, `PATCH`) を行うための汎用関数を実装する。
    *   リクエストヘッダー（`Authorization`, `Accept: application/vnd.github.v3+json`）を正しく設定する。
    *   API レスポンスの HTTP ステータスコードを確認し、適切にエラー処理を行う。
*   ✅ **タスク:** カスタム例外クラスを実装する。
    *   API エラーなどを表現する例外クラスを定義する。

#### 🌿 ブランチ作成

*   ✅ **タスク:** ベースブランチの最新コミット SHA を取得する関数を実装する。
    *   (GitHub API を利用)
*   ✅ **タスク:** 新しいブランチを作成する関数を実装する。
    *   (GitHub API を利用)
    *   ベースコミットの SHA を指定して新しいブランチを作成する。

#### 📝 コミット作成

*   ✅ **タスク:** 対象ブランチの最新コミット SHA を取得する関数を実装する。
    *   (GitHub API を利用)
*   ✅ **タスク:** 最新コミットのツリー SHA を取得する関数を実装する。
    *   (GitHub API を利用)
*   ✅ **タスク:** ファイル内容（BLOB）を作成する関数を実装する。
    *    (GitHub API を利用)
    *   ファイル内容を Base64 でエンコードする。
*   ✅ **タスク:** ツリーを作成する関数を実装する。
    *   (GitHub API を利用)
    *   BLOB の SHA とファイルパスを指定してツリーを作成する。
*   ✅ **タスク:** コミットを作成する関数を実装する。
    *   (GitHub API を利用)
    *   親コミット SHA、ツリー SHA、コミットメッセージを指定してコミットを作成する。
*   ✅ **タスク:** ブランチの先端を更新する関数を実装する。
    *   (GitHub API を利用)
    *   作成したコミット SHA を使用してブランチを更新する。
*   ✅ **タスク:** ファイルの追加・変更を行うための高レベルな関数を実装する。
    *   BLOB 作成、ツリー作成、コミット作成、ブランチ更新をまとめて行う。
    *   既存ファイル更新と新規ファイル追加に対応する。

#### 🔀 プルリクエスト作成

*   ✅ **タスク:** プルリクエストを作成する関数を実装する。
    *   (GitHub API を利用)
    *   ベースブランチ、ヘッドブランチ、PR タイトル、本文を指定
    *   使い方例:

```rust
let _ = client.create_pull_request(
    "owner",      // リポジトリのオーナー
    "repo",       // リポジトリ名
    "main",       // ベースブランチ（マージ先）
    "feature",    // ヘッドブランチ（マージ元）
    "PRのタイトル",
    "PRの本文"
).await?;
```

#### 🧪 テスト

*   📝 **タスク:** 単体テストを実装する。
    *   各関数が正しく動作するかテストする。

#### 📖 ドキュメント

*   📝 **タスク:** ライブラリの利用方法を説明するドキュメントを作成する。

### 📚 ライブラリの利用方法

#### ブランチ作成
```rust
// ベースブランチの最新コミットSHAを取得
let base_sha = client.get_base_branch_sha("owner", "repo", "main").await?;

// 新しいブランチを作成
client.create_branch("owner", "repo", "feature", &base_sha).await?;
```

#### コミット作成
```rust
// ファイルの内容をBLOBとして作成
let blob_sha = client.create_blob("owner", "repo", "ファイルの内容").await?;

// 最新のツリーSHAを取得
let base_sha = client.get_base_branch_sha("owner", "repo", "feature").await?;
let tree_sha = client.get_latest_tree_sha("owner", "repo", &base_sha).await?;

// BLOBを含む新しいツリーを作成
let new_tree_sha = client.create_tree("owner", "repo", &tree_sha, "path/to/file", &blob_sha).await?;

// 新しいコミットを作成
let commit_sha = client.create_commit("owner", "repo", "コミットメッセージ", &new_tree_sha, &base_sha).await?;

// ブランチの先端を更新
client.update_branch_reference("owner", "repo", "feature", &commit_sha).await?;
```

#### プルリクエスト作成
```rust
// プルリクエストを作成
client.create_pull_request(
    "owner",      // リポジトリのオーナー
    "repo",       // リポジトリ名
    "main",       // ベースブランチ（マージ先）
    "feature",    // ヘッドブランチ（マージ元）
    "PRのタイトル",
    "PRの本文"
).await?;
```

より詳細な使用例については、`examples/pull_request_creation.rs`を参照してください。

### 🚦 進捗状況

*   ✅ 共通設定の基本設計
*   ✅ 認証モジュールの実装
*   ✅ GitHub API クライアントの実装
*   ✅ カスタム例外クラスの実装
*   ✅ ブランチ作成機能の実装
*   ✅ コミット作成機能の実装
*   ✅ プルリクエスト作成機能の実装（詳細は下記「ドキュメント」参照）
*   ✅ 単体テストの実装
*   📝 ドキュメントの作成

### 📣 その他

*   このタスクリストは必要に応じて変更・追加してください。
*   各タスクの担当者を明確にすると、よりスムーズに開発が進むでしょう。
*   定期的に進捗状況を確認し、課題を共有しながら開発を進めてください。
*   ドキュメントは更新しながら開発を進めることで、よりよいドキュメントが作成できます。

